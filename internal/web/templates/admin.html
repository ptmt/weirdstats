{{define "content"}}
  <section class="hero-copy">
    <h2 class="section-title">Admin</h2>
    <p class="muted">Manage activity sync, view queue status, and perform admin operations.</p>
    {{if .Message}}
      <div class="card">
        <strong>{{.Message}}</strong>
      </div>
    {{end}}
  </section>

  <section class="admin-grid">
    <article class="card">
      <h3>Manual sync</h3>
      <p class="muted">Fetch activities from Strava and queue them for processing.</p>
      <div class="admin-actions">
        <form method="post" action="/admin/">
          <input type="hidden" name="action" value="sync-latest" />
          <button class="btn secondary" type="submit">Fetch latest</button>
        </form>
        <form method="post" action="/admin/">
          <input type="hidden" name="action" value="sync-month" />
          <button class="btn secondary" type="submit">Fetch last month</button>
        </form>
        <form method="post" action="/admin/">
          <input type="hidden" name="action" value="sync-year" />
          <button class="btn secondary" type="submit">Fetch last year</button>
        </form>
      </div>
    </article>

    <article class="card">
      <h3>Queue status</h3>
      <p class="muted">Activities waiting to be processed by the background worker.</p>
      <div class="stat-badge">{{.QueueCount}} pending</div>
    </article>

    <article class="card">
      <h3>Jobs</h3>
      <p class="muted">Durable background jobs for Strava sync (survive restarts).</p>
      {{if .Jobs}}
        <div class="job-table">
          <div class="job-row job-head">
            <span>Job</span>
            <span>Status</span>
            <span>Attempts</span>
            <span>Next run</span>
            <span>Updated</span>
          </div>
          {{range .Jobs}}
            <div class="job-row">
              <span class="job-type">#{{.ID}} Â· {{.TypeLabel}}</span>
              <span class="stat-tag status-tag {{.StatusClass}}">{{.Status}}</span>
              <span>{{.Attempts}} / {{.MaxAttempts}}</span>
              <span>{{.NextRunAt}}</span>
              <span>{{.UpdatedAt}}</span>
            </div>
            {{if .CursorSummary}}
              <div class="job-row job-cursor">
                <span>Cursor</span>
                <span class="job-cursor-text" title="{{.CursorSummary}}">{{.CursorSummary}}</span>
              </div>
            {{end}}
            {{if .LastError}}
              <div class="job-row job-error">
                <span>Error</span>
                <span class="job-error-text" title="{{.LastError}}">{{.LastError}}</span>
              </div>
            {{end}}
          {{end}}
        </div>
      {{else}}
        <p class="muted">No jobs yet.</p>
      {{end}}
    </article>

    <article class="card">
      <h3>Maps / Overpass</h3>
      <p class="muted">Run a sample Overpass query for traffic lights and cafes near a known busy block.</p>
      <form method="post" action="/admin/">
        <input type="hidden" name="action" value="test-overpass" />
        <button class="btn secondary" type="submit">Test Overpass</button>
      </form>
      <p class="muted">Uses the default Overpass endpoint unless <code>OVERPASS_URL</code> is set.</p>
    </article>

    <article class="card">
      <h3>Maintenance</h3>
      <p class="muted">Remove all background jobs (queued, running, retry, completed). Does not clear the activity queue.</p>
      <form method="post" action="/admin/">
        <input type="hidden" name="action" value="clear-jobs" />
        <button class="btn secondary" type="submit">Clear jobs</button>
      </form>
    </article>
  </section>

{{end}}
