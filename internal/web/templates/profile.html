{{define "content"}}
  <section class="hero-copy">
    {{if .Message}}
      <div class="card">
        <strong>{{.Message}}</strong>
      </div>
    {{end}}
    <h2 class="section-title">Your parsed activities</h2>
  </section>

  {{if .Contributions}}
    {{range .Contributions}}
      <section class="card contrib-card">
        <div class="contrib-header">
          <div>
            <h3>{{.Year}}</h3>
          </div>
          <div class="contrib-legend">
            <span class="legend-label">Less</span>
            {{range seq .Levels}}
              <span class="legend-swatch level-{{.}}"></span>
            {{end}}
            <span class="legend-label">More</span>
          </div>
        </div>
        <div class="contrib-grid-scroll">
          <div class="contrib-grid-wrap" style="--contrib-weeks: {{.Weeks}}">
            <div class="contrib-months">
              {{range .Months}}
                <span class="contrib-month" style="grid-column: {{.Column}}">{{.Label}}</span>
              {{end}}
            </div>
            <div class="contrib-grid">
              {{range .Days}}
                <span class="contrib-day level-{{.Level}}{{if not .InRange}} is-outside{{end}}" data-tooltip="{{.Tooltip}}" aria-label="{{.Tooltip}}"></span>
              {{end}}
            </div>
          </div>
        </div>
      </section>
    {{end}}
  {{end}}

  {{if .Activities}}
    <section class="stats-grid{{if .Contributions}} has-contrib{{end}}">
      {{range .Activities}}
        <article class="card activity-card{{if .IsHidden}} is-hidden{{end}}">
          <div class="activity-header">
            <div class="activity-header-main">
              <div class="activity-badges">
                <span class="activity-type type-{{.TypeClass}}">{{.TypeLabel}}</span>
                {{if .IsHidden}}<span class="activity-visibility">Hidden</span>{{end}}
              </div>
              <a href="/activity/{{.ID}}" class="activity-name">{{.Name}}</a>
              <div class="activity-meta">
                <span>{{.StartTime}}</span>
                <span class="sep">Â·</span>
                <span>{{.Duration}}</span>
              </div>
            </div>
            <div class="activity-menu">
              <button type="button" class="activity-menu-btn" onclick="this.parentElement.classList.toggle('open')" title="Actions">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <circle cx="12" cy="5" r="2"/>
                  <circle cx="12" cy="12" r="2"/>
                  <circle cx="12" cy="19" r="2"/>
                </svg>
              </button>
              <div class="activity-dropdown">
                <a href="/activity/{{.ID}}/download" class="dropdown-link">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                  </svg>
                  Download
                </a>
                <form method="post" action="/activity/{{.ID}}/refresh">
                  <button type="submit">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/>
                      <path d="M21 3v5h-5"/>
                    </svg>
                    Refresh
                  </button>
                </form>
                <button type="button">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="18" cy="5" r="3"/>
                    <circle cx="6" cy="12" r="3"/>
                    <circle cx="18" cy="19" r="3"/>
                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                  </svg>
                  Share
                </button>
                <button type="button">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                  </svg>
                  Report
                </button>
              </div>
            </div>
          </div>
          {{if .Description}}<div class="muted activity-description">{{.Description}}</div>{{end}}
          <div class="activity-metrics">
            <div class="metric">
              <div class="metric-label">Distance</div>
              <div class="metric-value">
                <span class="metric-number">{{.DistanceValue}}</span>
                {{if .DistanceUnit}}<span class="metric-unit">{{.DistanceUnit}}</span>{{end}}
              </div>
            </div>
            <div class="metric">
              <div class="metric-label">{{.PaceLabel}}</div>
              <div class="metric-value">
                <span class="metric-number">{{.PaceValue}}</span>
                {{if .PaceUnit}}<span class="metric-unit">{{.PaceUnit}}</span>{{end}}
              </div>
            </div>
            <div class="metric{{if not .HasPower}} is-muted{{end}}">
              <div class="metric-label">Avg power</div>
              <div class="metric-value">
                <span class="metric-number">{{.PowerValue}}</span>
                {{if .PowerUnit}}<span class="metric-unit">{{.PowerUnit}}</span>{{end}}
              </div>
            </div>
          </div>
          <div class="activity-substats">
            {{if .StopCount}}<span class="stat-tag secondary">{{.StopCount}} stops ({{.StopTotal}})</span>{{end}}
            {{if .LightStops}}<span class="stat-tag secondary">{{.LightStops}} at lights</span>{{end}}
          </div>
        </article>
      {{end}}
    </section>
  {{else}}
    <section class="card">
      <h2 class="section-title">No activities yet</h2>
      {{if .Strava.Connected}}
        <p class="muted">Your activities will appear here automatically as Strava syncs them; if you just connected, give it a few minutes.</p>
      {{else}}
        <p class="muted">Connect Strava to start pulling your activities and generating stop stats.</p>
        <a class="btn" href="/connect/strava">Connect Strava</a>
      {{end}}
    </section>
  {{end}}

  <script>
    document.addEventListener('click', function(e) {
      document.querySelectorAll('.activity-menu.open').forEach(function(menu) {
        if (!menu.contains(e.target)) {
          menu.classList.remove('open');
        }
      });
    });
  </script>
{{end}}
