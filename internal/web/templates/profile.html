{{define "content"}}
  <section class="hero-copy">
    {{if .Message}}
      <div class="card">
        <strong>{{.Message}}</strong>
      </div>
    {{end}}
    <h2 class="section-title">Your parsed activities</h2>
    <p class="muted">Every activity below shows the latest stop and traffic light stats we extracted.</p>
  </section>

  {{if .Activities}}
    <section class="stats-grid">
      {{range .Activities}}
        <article class="card activity-card">
          <div class="activity-header">
            <div>
              <a href="/activity/{{.ID}}" class="activity-name">{{.Name}}</a>
              <div class="activity-meta">
                <span>{{.Type}}</span>
                <span class="sep">/</span>
                <span>{{.StartTime}}</span>
              </div>
            </div>
            <div class="activity-menu">
              <button type="button" class="activity-menu-btn" onclick="this.parentElement.classList.toggle('open')" title="Actions">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <circle cx="12" cy="5" r="2"/>
                  <circle cx="12" cy="12" r="2"/>
                  <circle cx="12" cy="19" r="2"/>
                </svg>
              </button>
              <div class="activity-dropdown">
                <a href="/activity/{{.ID}}/download" class="dropdown-link">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                  </svg>
                  Download
                </a>
                <form method="post" action="/activity/{{.ID}}/refresh">
                  <button type="submit">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/>
                      <path d="M21 3v5h-5"/>
                    </svg>
                    Refresh
                  </button>
                </form>
                <button type="button">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="18" cy="5" r="3"/>
                    <circle cx="6" cy="12" r="3"/>
                    <circle cx="18" cy="19" r="3"/>
                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                  </svg>
                  Share
                </button>
                <button type="button">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                  </svg>
                  Report
                </button>
              </div>
            </div>
          </div>
          {{if .Description}}<div class="muted">{{.Description}}</div>{{end}}
          <div class="activity-stats">
            {{if .Distance}}<span class="stat-tag primary">{{.Distance}}</span>{{end}}
            {{if .Duration}}<span class="stat-tag primary">{{.Duration}}</span>{{end}}
            {{if .StopCount}}<span class="stat-tag secondary">{{.StopCount}} stops ({{.StopTotal}})</span>{{end}}
            {{if .LightStops}}<span class="stat-tag secondary">{{.LightStops}} at lights</span>{{end}}
          </div>
        </article>
      {{end}}
    </section>
  {{else}}
    <section class="card">
      <h2 class="section-title">No activities yet</h2>
      {{if .Strava.Connected}}
        <p class="muted">Your activities will appear here once they're synced from Strava.</p>
      {{else}}
        <p class="muted">Connect Strava to start pulling your activities and generating stop stats.</p>
        <a class="btn" href="/connect/strava">Connect Strava</a>
      {{end}}
    </section>
  {{end}}

  <script>
    document.addEventListener('click', function(e) {
      document.querySelectorAll('.activity-menu.open').forEach(function(menu) {
        if (!menu.contains(e.target)) {
          menu.classList.remove('open');
        }
      });
    });
  </script>
{{end}}
