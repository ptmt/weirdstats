{{define "content"}}
  <section class="hero-copy">
    <h2 class="section-title">Settings</h2>
    <p class="muted">Tune which activities are hidden and keep your account tidy.</p>
    {{if .Message}}
      <div class="card">
        <strong>{{.Message}}</strong>
      </div>
    {{end}}
  </section>

  <section class="settings-grid">
    <article class="card">
      <h3>Hide activity rules</h3>
      <p class="muted">Rules are applied after stats are computed. Toggle rules to control what gets muted.</p>
      <div class="settings-grid">
        {{if .Rules}}
          {{range .Rules}}
            <div class="card rule">
              <strong>{{.Name}}</strong>
              <span class="muted">{{.Description}}</span>
              <form method="post" action="/profile/settings">
                <input type="hidden" name="action" value="toggle-rule" />
                <input type="hidden" name="rule_id" value="{{.ID}}" />
                <label class="toggle">
                  <input type="checkbox" name="enabled" {{if .Enabled}}checked{{end}} />
                  Status: {{boolLabel .Enabled}}
                </label>
                <button class="btn secondary" type="submit">Update</button>
              </form>
              <form method="post" action="/profile/settings">
                <input type="hidden" name="action" value="delete-rule" />
                <input type="hidden" name="rule_id" value="{{.ID}}" />
                <button class="btn secondary" type="submit">Delete rule</button>
              </form>
            </div>
          {{end}}
        {{else}}
          <div class="card rule">
            <strong>No rules yet</strong>
            <span class="muted">Add a rule below to start hiding activities.</span>
          </div>
        {{end}}
      </div>
      <form method="post" action="/profile/settings" style="margin-top: 16px;" class="card rule">
        <input type="hidden" name="action" value="add-rule" />
        <label>
          <div class="muted">Rule name</div>
          <input name="name" placeholder="Hide late night rides" />
        </label>
        <label>
          <div class="muted">Condition</div>
          <input name="condition" placeholder="type = Ride AND start_time after 22:00" />
        </label>
        <label class="toggle">
          <input type="checkbox" name="enabled" checked />
          Enabled
        </label>
        <button class="btn" type="submit">Add rule</button>
      </form>
    </article>

    <article class="card">
      <h3>Strava connection</h3>
      <p class="muted">Manage your Strava account connection. Reconnect if you're having permission issues.</p>
      <div class="settings-actions">
        <a class="btn secondary" href="/connect/strava?force=1">Reconnect Strava</a>
        <form method="post" action="/profile/settings">
          <input type="hidden" name="action" value="sign-out" />
          <button class="btn secondary" type="submit">Sign out</button>
        </form>
      </div>
    </article>

    <article class="card">
      <h3>Danger zone</h3>
      <p class="muted">Delete your data, revoke tokens, and stop processing.</p>
      <form method="post" action="/profile/settings" class="rule">
        <input type="hidden" name="action" value="delete-account" />
        <label>
          <div class="muted">Type "delete" to confirm</div>
          <input name="confirm" placeholder="delete" />
        </label>
        <button class="btn danger" type="submit">Delete account</button>
      </form>
    </article>
  </section>

{{end}}
